---
title: "Introduction to the mondate Package"
author: "Dan Murphy"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
#output: rmarkdown::word_document
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Base R provides the two broad date/time classes:
`POSIXt` and `Date`.
Objects of these classes
mark a day with the instant of
time that begins the day. 
This conforms with 
internationally recognized 
standards^[Refer to http://www.iso.org/iso/home/standards/iso8601.htm
or
https://en.wikipedia.org/wiki/ISO_8601].
In contrast, 
`mondate` objects represent a day as at the instant of time that ends the day.
This "close of business" perspective can be useful, 
as when modeling accounting as-of dates.

The other major purpose of the `mondate` package is to measure elapsed time in 
units of "months", and therefore also "years".

The four major benefits of the mondate package are:

1. Date Aging
1. Date Formatting
1. Date Sequencing
1. Date Cutting

## Date Aging

The "age" of an event plays many important roles in business use cases.
By default, `Date` objects are measured in units of "days" and `POSIXt` objects in 
units of "seconds".
But sometimes it is more convenient to measure elapsed time in units of 
"months" or "years".
This is where `mondate` comes in.

For example, 
if my "birth event" took place on February 29, 1996
then my age on February 28, 2006 was 10:

```{r birthday}
require(mondate)
YearsBetween("1996-02-29", "2006-02-28")
```
or in the US
```{r}
YearsBetween("2/29/1996", "2/28/2006")
# and
MonthsBetween("2/29/1996", "2/28/2006")
# or simply
m1 <- mondate.ymd(1996, 2)
m2 <- mondate.ymd(2006, 2)
m2 - m1
```

As another example,
suppose ABC Company invoices a customer in late October 2015
and has a policy of recognizing those invoices to have been sent
on the 1st of November.
This code calculates the ages of that invoice in months 
as of the end of 2015 and 2016:

```{r}
invoiceDate = as.Date("2015-11-01")
ages <- mondate.ymd(2015:2016) - invoiceDate
print(ages)
```

#### Actuarial example

For a final example in this section,
suppose ABC Company records the date of insured losses using the variable name
DateOfLoss. 
The ages of each loss as of various quarter-ends using
`mondate.ymd` to generate the quarter-ends,
and then simply subtract.

```{r}
# generate 10 random dates after 2010
set.seed(1)
z <- rexp(10, .1)
DateOfLoss <- as.Date(mondate.ymd(2010) + z)
print(DateOfLoss)

# Quarter-ends in 2013
QE <- mondate.ymd(2013, 3 * 1:4, displayFormat = "%Y%m")
names(QE) <- QE

# a matrix of ages in units of months
Ages <- sapply(QE, `-` , DateOfLoss)
# code "not available" ages corresponding to evaluation dates prior to Date of Loss
# (one instance)
Ages[Ages <= 0] <- NA
print(Ages)

# Accident year age
AccidentYear <- year(DateOfLoss)
aybegin <- sort(unique(as.Date(mondate.ymd(AccidentYear, 1, 1))))
print(sapply(QE, `-`, aybegin))
```

See the "Date Cutting" section below for a
more elegant way to do the last calculation.

## Date Formatting

`mondate` enables dates to be read and displayed in more than one format.
The default formats currently recognized are

* US format: "%m/%d/%Y" or "%m-%d-%Y"
* EU format: "%Y-%m-%d" or "%Y/%m/%d"

in that order,
depending on your value of `Sys.getlocale("LC_TIME")`.
The order can be changed and new formats added using `base::options`
for display ("writing") and 
`set.mondate.displayFormats` for "reading".

#### "writing": dynamic format display

This vignette is being written in the US, 
so today's date will be represented using the first format above by default ...

```{r}
mondate(Sys.Date())
```

... but that default can be changed to the
international standard format^[ibid.]
"YYYY-MM-DD" using
`base::options` and the name
"mondate.default.displayFormat" as follows

```{r}
options(mondate.default.displayFormat = "%Y-%m-%d")
mondate(Sys.Date())
```

As another example, 
French users may choose the format "dd/mm/YYYY" as follows:

```{r}
options(mondate.default.displayFormat = "%d/%m/%Y")
mondate(Sys.Date())
```

Note: 
these examples modified the default display format
for **all** mondates in the R session.
To set the display format for **just one** instance of a mondate object,
use the `displayFormat` argument during the object's creation.
Here we create the first 6 month-ends of 2015
to be displayed in the French format above
despite the fact that the default format is changed to the ISO standard:

```{r}
options(mondate.displayFormat = "%Y-%m-%d")
mondate(Sys.Date())
m <- mondate.ymd(2015, 1:6, displayFormat = "%d/%m/%Y")
print(m)
```
```{r echo=FALSE, message=FALSE}
options(mondate.displayFormat = NULL)
```
```{r}

```

More creative formats can be used, 
as for instance
to display just the year and month.
Here are the first six 
month-ends of 2016 displayed using a format that only shows year and month.

```{r}
m <- mondate.ymd(2016, 1:6, displayFormat = "%Y%m")
print(m)
```

#### "reading": dynamic format detection

As mentioned above,
the `mondate` package is pre-loaded with four formats for detecting dates

1. US format a: "%m/%d/%Y"
2. US format b: "%m-%d-%Y"
3. EU format a: "%Y-%m-%d"
4. EU format b: "%Y/%m/%d"

To inform `mondate` of another format for converting character to date,
use `set.mondate.displayFormats`.
This function sets the `options` value of "mondate.displayFormats"
to the value(s) of your choice.

For example, to add the French format "dd/mm/yyyy" to the *head* of the
current list of detectable formats, 
use the following code:

```{r}
set.mondate.displayFormats(c("%d/%m/%Y", 
                             get.mondate.displayFormats()), 
                           clear = TRUE)
```
(This example is given in ?set.mondate.displayFormats.)
Contining, 
suppose dates in a spreadsheet are saved to a csv file in France
and the `read.csv` function results in this data.frame:
```{r}
data <- data.frame(
  cbind(Invoice=c("A", "B", "C"),
        datechar = c("28/11/2015", "29/11/2015", "30/11/2015")))
print(data)
```
Then the character dates can be converted automatically to `Date` objects
via `mondate` as follows
```{r}
data$InvoiceDate <- as.Date(mondate(data$datechar))
print(data)
```

For more information on the codes to use when formatting dates,
see the R help page for the `strptime` function.
To add addtional defaults according to your value of
`Sys.getlocale("LC_TIME")`,
contact the 
author^[chiefmurphy at gmail].
(All are welcome to visit the package's public repository at
https://github.com/chiefmurph/mondate.)

## Date Sequencing
## Date Cutting

## Thank you

Damien Laker


## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))

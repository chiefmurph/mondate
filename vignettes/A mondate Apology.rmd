---
title: "A mondate Apology"
author: "Dan Murphy"
date: "November 19, 2015"
output: word_document
---

The following example sentences are found throughout Financial Services:

A. The value of ABC Company liabilities as of December 31, 2015 is $100M.

B. The age of November receivables as of December 31, 2015 is two months.

The "asof" and "emonth" packages were written to simplify the modeling of these
two sentences in 
R.

# Package asof

## Accounting Date

> Definition: Accounting Date  
An accounting date is the cutoff date for 
reflecting events and recording amounts as paid or unpaid
in a financial statement or accounting system. 
The accounting date is sometimes referred to as the “as of” 
date.^[Casualty Actuarial Society *Statement
of Principles Regarding Property and Casualty Unpaid Claims Estimates*]

Although financial statements are always stated as of a date, 
say, December 31, 2015,
it would be more thorough to assign a time as well,
so as to identify all transactions
impacting the financial statements as of that date.
Some say "any particular moment on the 31st" could be used.^["it 
would be more accurate to write December 31, 20XX, 11:59:59, 
or any particular moment on the 
31st." http://www.investopedia.com/university/accounting/accounting5.asp]
However, payments can potentially occur up to and including midnight
December 31, 2015,
so if a time designator is to be used, 
midnight
would be the most appropriate.


The International Organization for Standardization (ISO) sets
the standards for computer representation of
dates and times as a string of characters.
In particular,
to represent the moment in time separating day 1 from day 2,
ISO recognized that it had a choice between using the format
24:00:00 ("hour 24") on day 1 or format 00:00:00 ("hour 00") on day 2.
ISO chose not to adopt the former, rear-facing, accounting fomat but the latter,
forward-facing, experimental-design format.^["Midnight ...
may be referred to as either '00:00' or '24:00'.
The notation '00:00' is used at the beginning of a calendar day and 
is the more frequently used. 
At the end of a day use '24:00',
i.e., midnight.
'2007-04-05T24:00' is the same instant as '2007-04-06T00:00'. 
www.wikipedia.org/wiki/ISO_8601]
These standards are known as ISO 
8601.
^[ISO 8601, Third edition, *Data elements and interchange formats -- Information 
interchange -- Representation of dates and times*
(c) ISO 2004]

Base
R
follows ISO 8601.

"Under the hood"
base
R
stores time as the number of *seconds* since the beginning
of 1970.^[The `POSIXt` classes. 
In R, see ?DateTimeClasses. 
For additional background, see https://en.wikipedia.org/wiki/Unix_time]
Base
R
stores dates without time as the number of *days* since the beginning
of 1970.^[The `Date` class. 
See ?Dates.]

For example, 
here we tell R that we want to store the instant in time belonging
to the first day of 2016 
in the variable *t*. 
Per ISO 8601, 
the proper format for that moment is "2015-01-01 00:00:00".
Internally,
R stores that moment as
`r prettyNum(as.numeric(as.POSIXct("2016-01-01 00:00:00")))`
seconds since the beginning of 1970.
R's
`as.numeric` function strips away the POSIXct class'
accoutrements to reveal the number inside.

```{r} 
t <- as.POSIXct("2016-01-01 00:00:00")
as.numeric(t)
```

In the spirit of 8601 historical development,
R developers allow
R
to recognize hour 24
as being
the same moment in time as hour 00 the following day.^[Per `?strptime`
"As a special exception strings such as 24:00:00 are accepted for input, 
since ISO 8601 allows these."]
However
R
will consistently use hour 00 when communicating that moment back to the user.

For example,
here we tell 
R
to store the 24th hour of December 31, 2015 in the variable *u*.
Note that R stores the same number of seconds for 
*u* as for *t* above.
Therefore,
R
considers those character strings to represent
the same moment in time.
When R uses 8601 format to communicate moment *u* back to the user,
it says the moment is hour 00 January 1st.

``` {r}
u <- as.POSIXct("2015-12-31 24:00:00")
as.numeric(u)
as.character(u, format = "%Y-%m-%d %H:%M:%S")
```

The same 8601-consistent behavior occurs with 
R's
`Date` class.
Here we tell
R
to record the day (no time)
on which the moment 2015-12-31 24:00:00 occurs.
When the date is communicated back to the user,
January 1st is displayed.

```{r}
d <- as.Date("2015-12-31 24:00:00", format = "%Y-%m-%d %H:%M:%S")
d
```

This 8601-consistent behavior can lead to confusion
when a December 31st *accounting date* is defined to R
using the last moment of that day,
but R subsequently displays that date as January 1st.
It would be preferable to be able to define an "asof" 
accounting date so that R

* Stores the correct number of seconds (or days) 
from 1970-01-01 00:00:00 until hour 24 that day,
and 
* Displays back to the user the traditional "as of" date,
i.e., the day
on which hour 24 occurs,
not the following day on which hour zero occurs.

That is the purpose of the "asof" package.

# Package emonth

## Age

> Definition: Age  
The age of event E as of accounting date A is the 
length of time between the occurrence of event E and the end of 
date A.

Note that units are not mentioned in the definition of age. 
This is because the appropriate unit should be specific to the use case.

There is little ambiguity in defining elapsed time 
(durations) in units of
seconds or days.
R's
two Date/Time classes facilitate date/time
arithmetic in uits of seconds and days.

* The POSIXt classes store time as the number of seconds
since the beginning of 1970, 
so elapsed time in units of seconds is easily combined
with a POSIXt object to yield another POSIXt object unambiguously.

* The Date class stores time as the number of days
since the beginning of 1970,
so elapsed time in units of days is easily combined
with a Date object to yield another Date object unambiguously.

It is more complicated with units of months because
month periods are comprised of different numbers of days.
But this complication can be overcome with two key observations.

1. It is commonly accepted that the length of time between 
the beginning and end of a month is one "month".

2. Given any time *t* in any given month,
there is a unique portion *p*, 0<=*p*<=1,
that represents the portion of the month completed by time *t*.
Conversely, given any portion *p*,
the point in time of a month completed as of that portion of the month
can be easily found.

Those two observations give rise to the definition of the 
"month-time" of an instant in time:

>Definition: Month Time  
The month time of time *t* is a real number
measuring the number of months since the beginning of 1970 to time *t*.
The fractional part of the real number represents the portion
of *t*'s month to have expired by time *t*.



R
has two classes,
POSIXlt and POSIXct

### Sentence B

Base R follows that standard and represents an instant of time 
as the number of seconds that have transpired since the beginning of 1970.

It is well known that "months" are comprised of different 
numbers of days.
Although it is widely accepted that the length of time between 
the beginning and end of a month is one "month",
it is also recognized that month durations
cannot be defined consistently in units of days.
Those observations give rise to a different type of unit:
"elapsed month" or "emonth".

> Definition: Elapsed Month ("emonth")  
The length of time between two instants in time *t1* and *t2*
in units of "emonths" is  
  mondate(*t2*) - mondate(*t1*)
where
  *mondate(t)* is a real number representing
the number of months between the beginning of 1970 and
time *t*.

> Example  
mondate("1970-02-01") = 1  
mondate("1971-01-01") = 12
mondate("1970-02-15 00:00:00") = 1.5 because the beginning of 
February 15, 1970 is halfway through February 1970.
as.Date("1971-01-01") - as.Date("1971-02-01") = 10.5 emonths 

Conversely, given any real number t, 
it is straightforward to find the time ?YYYYMMDD?HH:MM:SS.zzzzz? 
that is t months away from the beginning of 1970 by 
first counting whole months, 
then counting into the next month (if necessary) the number of days and 
seconds corresponding to that month per the fractional value of t.

> Defintion: Elapsed Years  
The number of elapsed years between times *t1* and *t2*
equals the number of elapsed months divided by 12.

### Case Study:

ABC Ins. Co. started on 1/1/2010 to write earthquake insurance in California. 
As claims are made, 
ABC defines the occurrence date of a claim claim to be the date of 
the earthquake and stores that date in an ISO-8601 compliant o
bject (`POSIXt`). 
ABC has had good luck so far -- only 20 claims have been made. 
Here are their occurrence dates and their know values as of 12/31/2015:

data ?

To complete Sentence B, we need one more definition:

> Definition: The age of accident year AY as of AOD is AOD - AY-01-01.

The accident year age of the 20 claims is the vector  
	mondate(?2015-12-31?) ? year(occurrenceDate)-01-01



http://smallbusiness.chron.com/differences-dates-between-balance-sheet-income-sheet-24881.html

"Balance Sheet Date
A balance sheet often states that it is prepared as of a specific date, referred to as the balance sheet date. The balance sheet reports on a company’s financial conditions, namely the values of the company’s assets, liabilities and shareholders’ equity. Values are measured in terms of their monetary amounts at particular points in time rather than over any periods. At the end of an accounting cycle, with the accounting books closed to recording new business transactions, companies can summarize their financial conditions as of the cycle's end."

http://www.casact.org/professionalism/standards/princip/SOP-Regarding-Property-and-Casualty-Unpaid-Claims-Estimates_Final%204-22-2015.pdf

# Bibliography

Here's a pretty good paper about dates, Lubridate, Chron:
http://biostat.mc.vanderbilt.edu/wiki/pub/Main/ColeBeck/datestimes.pdf